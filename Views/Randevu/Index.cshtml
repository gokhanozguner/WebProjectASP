@model IEnumerable<GokhanOzgunerWEB.Models.Randevu>

@{
    ViewData["Title"] = "Tüm Randevular";
}

<h2 class="mb-4"><i class="bi bi-calendar3"></i> Tüm Randevular</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show">
        <i class="bi bi-check-circle"></i> @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="card shadow">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>Tarih & Saat</th>
                        <th>Üye</th>
                        <th>Antrenör</th>
                        <th>Hizmet</th>
                        <th>Ücret</th>
                        <th>Durum</th>
                        <th class="text-end">İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        var durumBadge = item.Durum switch
                        {
                            GokhanOzgunerWEB.Models.RandevuDurum.Beklemede => "warning",
                            GokhanOzgunerWEB.Models.RandevuDurum.Onaylandi => "success",
                            GokhanOzgunerWEB.Models.RandevuDurum.Reddedildi => "danger",
                            GokhanOzgunerWEB.Models.RandevuDurum.Tamamlandi => "info",
                            GokhanOzgunerWEB.Models.RandevuDurum.IptalEdildi => "secondary",
                            _ => "secondary"
                        };

                        <tr>
                            <td>
                                <strong>@item.RandevuTarihi.ToString("dd/MM/yyyy")</strong><br>
                                <small>@item.BaslangicSaati.ToString(@"hh\:mm") - @item.BitisSaati.ToString(@"hh\:mm")</small>
                            </td>
                            <td>@item.Uye?.AdSoyad</td>
                            <td>@item.Antrenor?.AdSoyad</td>
                            <td>@item.Hizmet?.Ad</td>
                            <td><strong>@item.Hizmet?.Ucret.ToString("C2")</strong></td>
                            <td>
                                <span class="badge bg-@durumBadge">@item.Durum</span>
                            </td>
                            <td class="text-end">
                                @if (item.Durum == GokhanOzgunerWEB.Models.RandevuDurum.Beklemede)
                                {
                                    <form asp-action="Approve" asp-route-id="@item.Id" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-success" title="Onayla">
                                            <i class="bi bi-check-circle"></i>
                                        </button>
                                    </form>
                                    <form asp-action="Reject" asp-route-id="@item.Id" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-danger" title="Reddet">
                                            <i class="bi bi-x-circle"></i>
                                        </button>
                                    </form>
                                }
                                else if (item.Durum == GokhanOzgunerWEB.Models.RandevuDurum.Onaylandi)
                                {
                                    <form asp-action="Cancel" asp-route-id="@item.Id" method="post" class="d-inline"
                                          onsubmit="return confirm('İptal etmek istediğinizden emin misiniz?')">
                                        <button type="submit" class="btn btn-sm btn-warning" title="İptal Et">
                                            <i class="bi bi-x-circle"></i> İptal
                                        </button>
                                    </form>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (!Model.Any())
        {
            <div class="text-center py-5">
                <i class="bi bi-inbox display-1 text-muted"></i>
                <p class="text-muted mt-3">Henüz randevu bulunmamaktadır.</p>
            </div>
        }
    </div>
</div>